# Отчет по анализу падающих тестов проекта py2puml

## Общая статистика

- **Всего тестов**: 59
- **Проходящих тестов**: 55 (93%)
- **Падающих тестов**: 4 (7%)

## Детальный анализ падающих тестов

### 1. `test_complex_type_annotations` (tests/functional/test_output_format.py)

**Проблема**: Ошибка в коде - не обрабатываются аннотированные атрибуты в `__init__`

**Ожидаемый результат**: 
```
+ {static} simple_field: str
```

**Фактический результат**:
```
class TestClass {
  ~ __init__(self)
  + method_with_types(self, param1, param2)
}
```

**Анализ**: Код не извлекает аннотированные атрибуты из метода `__init__`. Метод `extract_fields_from_init` не обрабатывает `ast.AnnAssign` узлы.

**Решение**: Необходимо доработать метод `extract_fields_from_init` в `uml_generator.py` для обработки аннотированных атрибутов.

---

### 2. `test_method_parameters` (tests/functional/test_output_format.py)

**Проблема**: Ошибка в коде - не обрабатываются `*args` и `**kwargs` в сигнатурах методов

**Ожидаемый результат**: 
```
method_with_params(param1, param2)
```

**Фактический результат**:
```
method_with_params(self, param1, param2)
```

**Анализ**: Код не обрабатывает `*args` и `**kwargs` в сигнатурах методов. Метод `process_method_def` не извлекает эти параметры из AST.

**Решение**: Необходимо доработать метод `process_method_def` в `uml_generator.py` для обработки `*args` и `**kwargs` параметров.

---

### 3. `test_error_handling_in_output` (tests/functional/test_output_format.py)

**Проблема**: Ошибка в коде - при синтаксической ошибке в одном классе пропускается весь файл

**Ожидаемый результат**: 
```
class ValidClass
```

**Фактический результат**:
```
@startuml
package "broken" <<Frame>> #F0F0FF {
}
@enduml
```

**Анализ**: При синтаксической ошибке в одном классе код пропускает весь файл, включая валидные классы. Ошибка в `parse_python_file` - при `SyntaxError` возвращается пустой список.

**Решение**: Необходимо изменить логику обработки ошибок в `parse_python_file` - обрабатывать каждый класс отдельно и пропускать только проблемные классы.

---

### 4. `test_plantuml_syntax_completeness` (tests/functional/test_output_format.py)

**Проблема**: Ошибка в коде - неправильное определение типа абстрактного класса

**Ожидаемый результат**: 
```
abstract class AbstractClass
```

**Фактический результат**:
```
interface AbstractClass
```

**Анализ**: Код неправильно определяет тип абстрактного класса. Метод `determine_class_type` возвращает `interface` вместо `abstract class` для классов с `@abstractmethod`.

**Решение**: Необходимо доработать метод `determine_class_type` в `uml_generator.py` для правильного определения абстрактных классов.

---

## Резюме

Все 4 падающих теста выявляют **реальные ошибки в коде**, а не проблемы в тестах:

1. **Неполная обработка аннотированных атрибутов** - код не извлекает типизированные поля из `__init__`
2. **Неполная обработка параметров методов** - код не обрабатывает `*args` и `**kwargs`
3. **Слишком строгая обработка ошибок** - при ошибке в одном классе пропускается весь файл
4. **Неправильное определение типов классов** - абстрактные классы определяются как интерфейсы

Эти проблемы требуют доработки кода в `uml_generator.py` для улучшения функциональности парсера Python AST. 